plot(append_reserve(benchmarks, pa_1, "PA_1"))
plot(append_reserve(benchmarks, pa_1, "PA_1")$geometry)
pa_1 <- catchments_to_benchmarks(benchmark_table_sample, catchments_sample, c("PB_0003", "PB_0002"))
plot(pa_1)
benchmarks <- catchments_to_benchmarks(benchmark_table_sample, catchments_sample, c("PB_0001"))
append_reserve(benchmarks, pa_1, "PA_1"
)
plot(append_reserve(benchmarks, pa_1, "PA_1"))
plot(append_reserve(benchmarks, pa_1, "PA_1")$geometry)
document()
test()
pa_1 <- data.frame(lon = c(-85, -82.5, -83), lat = c(51, 51.5, 50.5)) %>%
sf::st_as_sf(coords = c("lon", "lat"), crs = 4326) %>%
dplyr::summarise(geometry = st_combine(geometry)) %>%
sf::st_cast("POLYGON") %>%
sf::st_transform(st_crs(benchmarks)) %>%
dplyr::mutate(pa_name="a protected area", ha=9999, class="provincial")
benchmarks <- catchments_to_benchmarks(benchmark_table_sample, catchments_sample, c("PB_0001", "PB_0002"))
pa_1
benchmarks
expect_snapshot(append_reserve(benchmarks, pa_1, "PA_1"))
test()
test()
snapshot_accept('spatial')
test()
load_all()
test()
load_all()
test()
load_all()
test()
benchmark_table_sample
catchments_sample
reserves <- catchments_to_benchmarks(benchmark_table_sample, catchments_sample, c("PB_0001", "PB_0002"))
target_table <- gen_targets(ref_poly, led_sample, 1600)
evaluate_targets_using_clip(reserves, "network", led_sample, target_table)
as.data.frame(evaluate_targets_using_clip(reserves, "network", led_sample, target_table))
target_table
ref_poly
plot(ref_poly)
led_sample
test()
snapshot_accept('representation')
catchments_to_benchmarks(benchmark_table_sample, catchments_sample, c("PB_0001", "PB_0002"))
catchments_to_benchmarks(benchmark_table_sample, catchments_sample, c("PB_0001__PB_0002"))
gen_targets(ref_poly, led_sample, 5000)
gen_targets(ref_poly, led_sample, 10000)
gen_targets(ref_poly, led_sample, 10000, c(1:5))
target_table <- gen_targets(ref_poly, led_sample, 1600)
evaluate_targets_using_catchments(catchments_sample, "led", benchmark_table_sample, target_table, colnames(benchmark_table_sample))
as.data.frame(evaluate_targets_using_catchments(catchments_sample, "led", benchmark_table_sample, target_table, colnames(benchmark_table_sample)))
reserves <- catchments_to_benchmarks(benchmark_table_sample, catchments_sample, c("PB_0001", "PB_0002"))
target_table <- gen_targets(ref_poly, led_sample, 1600)
evaluate_targets_using_clip(reserves, "network", led_sample, target_table)
as.data.frame(evaluate_targets_using_clip(reserves, "network", led_sample, target_table))
test()
snapshot_accept('representation')
test()
benchmarks_sf <- catchments_to_benchmarks(benchmark_table_sample, catchments_sample)
benchmarks_sf <- catchments_to_benchmarks(benchmark_table_sample, catchments_sample, colnames(benchmark_table_sample))
network_list <- c("PB_0001__PB_0002", "PB_0001__PB_0003")
check_for_network <- function(reserves_sf){
if(!"network" %in% names(reserves_sf)){
stop("Benchmark/network object must contain column: network")
}
}
check_for_network(benchmarks_sf)
names(benchmarks_sf)[names(benchmarks_sf)=="network"]
names(benchmarks_sf)[names(benchmarks_sf)=="network"]<-"networks"
check_for_network(benchmarks_sf)
names(benchmarks_sf)[names(benchmarks_sf)=="networks"]<-"network"
check_for_network(benchmarks_sf)
benchmark_table_sample
catchments_sample
ncols(catchments_sample)
colnames(catchments_sample)
catchments_sample[colnames(catchments_sample) != "CATCHNUM",]
catchments_sample[colnames(catchments_sample) != "CATCHNUM"]
colnames(catchments_sample) != "CATCHNUM"
catchments_to_benchmarks(benchmark_table_sample, catchments_sample[colnames(catchments_sample) != "CATCHNUM"], c("PB_0001__PB_0002"))
expect_error(
catchments_to_benchmarks(benchmark_table_sample, catchments_sample[colnames(catchments_sample) != "CATCHNUM"], c("PB_0001__PB_0002")),
"CATCHNUM"
)
pa_1 <- catchments_to_benchmarks(benchmark_table_sample, catchments_sample, c("PB_0003", "PB_0002"))
benchmarks <- catchments_to_benchmarks(benchmark_table_sample, catchments_sample, c("PB_0001"))
benchmarks
names(benchmarks)
names(benchmarks) <- c("networks", "geometry")
append_reserve(benchmarks, pa_1, "PA_1")
append_reserve <- function(benchmarks_sf, add_reserve, reserve_name){
check_for_network(benchmarks_sf)
# dissolve add_reserve into one feature
add_reserve <- add_reserve %>%
dplyr::summarise(geometry = sf::st_union(geometry)) %>%
dplyr::mutate(network = reserve_name)
# append to benchmarks_sf
benchmarks_sf <- rbind(benchmarks_sf, add_reserve)
return(benchmarks_sf)
}
append_reserve(benchmarks, pa_1, "PA_1")
benchmark_table
benchmark_table
benchmark_table<-benchmark_table_sample
benchmark_table
colnames(benchmark_table)
nets
nets<-c("PB_0001", "PB_0002")
nets
nets %in% colnames(benchmark_table)
all(nets %in% colnames(benchmark_table))
!all(nets %in% colnames(benchmark_table))
paste0("names do not appear as colnames in the benchmark table: ", nets[!nets %in% colnames(benchmark_table)])
nets<-c("PB_0001", "PB_0002", "PBxxx")
if(!all(nets %in% colnames(benchmark_table))){
stop(paste0("names do not appear as colnames in the benchmark table: ", nets[!nets %in% colnames(benchmark_table)]))
}
benchmark_sf
nets
benchmarks_sf
benchmarks_sf$network
all(nets %in% benchmarks_sf$network)
net[!nets %in% benchmarks_sf$network]
nets[!nets %in% benchmarks_sf$network]
stop(paste0("reserve names are not in sf objects network column: ", nets[!nets %in% benchmarks_sf$network]))
nets <- c("Poooo", nets)
stop(paste0("reserve names are not in sf objects network column: ", nets[!nets %in% benchmarks_sf$network]))
paste0("reserve names are not in sf objects network column: ", paste0(nets[!nets %in% benchmarks_sf$network], sep=" "))
nets[!nets %in% benchmarks_sf$network]
stop(paste0("reserve names are not in sf objects network column: ", nets[!nets %in% benchmarks_sf$network], collapse = "_"))
paste0(nets[!nets %in% benchmarks_sf$network], collapse=", ")
stop(paste0("reserve names are not in sf objects network column: ", paste0(nets[!nets %in% benchmarks_sf$network], collapse=", ")))
stop(paste0("reserve names are not in sf objects 'network' column: ", paste0(nets[!nets %in% benchmarks_sf$network], collapse=", ")))
if(!all(nets %in% benchmarks_sf$network)){
stop(paste0("reserve names are not in sf objects 'network' column: ", paste0(nets[!nets %in% benchmarks_sf$network], collapse=", ")))
}
nets <- sep_network_name(net)
net <- network_list[1]
net
nets <- sep_network_name(net)
nets
check_benchmark_sf_names(benchmarks_sf)
check_benchmark_sf_names <- function(nets, benchmarks_sf){
if(!all(nets %in% benchmarks_sf$network)){
stop(paste0("reserve names are not in sf objects 'network' column: ", paste0(nets[!nets %in% benchmarks_sf$network], collapse=", ")))
}
}
check_benchmark_sf_names(benchmarks_sf)
check_benchmark_sf_names(nets, benchmarks_sf)
nets
benchmarks_sf %>%
filter(network %in% nets)
benchmarks_sf %>%
dplyr::filter(network %in% nets)
row_sfc <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
sf::st_union()
row_sfc
plot(row_sfc)
sf::st_sf(network = net, geometry = row_sfc)
row <- sf::st_sf(network = net, geometry = row_sfc)
plot(row)
network_list
counter <- 1
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row_sfc <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
sf::st_union()
row <- sf::st_sf(network = net, geometry = row_sfc)
# append
if(counter == 1){
out_sf <- row
count <- counter + 1
} else{
out_sf <- rbind(out_sf, row)
}
}
out_sf
counter
counter <- 1
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row_sfc <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
sf::st_union()
row <- sf::st_sf(network = net, geometry = row_sfc)
# append
if(counter == 1){
out_sf <- row
counter <- counter + 1
} else{
out_sf <- rbind(out_sf, row)
}
}
out_sf
plot(out_sf[2])
plot(out_sf)
plot(out_sf[1])
plot(out_sf$geometry[1])
plot(out_sf$geometry[2])
document()
load_all()
network_list <- rep(network_list, 1000)
network_list
length(network_list)
benchmarks_sf
benchmarks_to_networks(benchmarks_sf, network_list)
benchmarks_to_networks <- function(benchmarks_sf, network_list){
check_for_network(benchmarks_sf)
check_for_geometry(benchmarks_sf)
counter <- 1
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row_sfc <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
sf::st_union()
row <- sf::st_sf(network = net, geometry = row_sfc)
# append
if(counter == 1){
out_sf <- row
counter <- counter + 1
} else{
out_sf <- rbind(out_sf, row)
}
}
return(out_sf)
}
benchmarks_to_networks(benchmarks_sf, network_list)
?st_union
out_sf
network_list
network_list <- network_list[2]
network_list
network_list <- c("PB_0001__PB_0002", "PB_0001__PB_0003")
network_list
net
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row_sfc <- benchmarks_sf %>%
dplyr::filter(network %in% nets) #%>%
#sf::st_union()
#row <- sf::st_sf(network = net, geometry = row_sfc)
# append
if(counter == 1){
out_sf <- row
counter <- counter + 1
} else{
out_sf <- rbind(out_sf, row)
}
}
out_sf
counter <- 1
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row <- benchmarks_sf %>%
dplyr::filter(network %in% nets) #%>%
#sf::st_union()
#row <- sf::st_sf(network = net, geometry = row_sfc)
# append
if(counter == 1){
out_sf <- row
counter <- counter + 1
} else{
out_sf <- rbind(out_sf, row)
}
}
out_sf
benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
dplyr::mutate(network = net)
counter <- 1
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
dplyr::mutate(network = net)
#sf::st_union()
#row <- sf::st_sf(network = net, geometry = row_sfc)
# append
if(counter == 1){
out_sf <- row
counter <- counter + 1
} else{
out_sf <- rbind(out_sf, row)
}
}
out_sf
out_sf %>%
dplyr::group_by(network) %>%
sf::st_union()
out_sf %>%
dplyr::group_by(network)
out_sf %>%
dplyr::group_by(network) %>%
summarize(geometry = sf::st_union(geometry))
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry))
out_sf
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry))
class(out_sf)
out_sf <- out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry))
class(out_sf)
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
as.data.frame()
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
as_sf()
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
sf::st_as_sf()
counter <- 1
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
dplyr::mutate(network = net)
#sf::st_union()
#row <- sf::st_sf(network = net, geometry = row_sfc)
# append
if(counter == 1){
out_sf <- row
counter <- counter + 1
} else{
out_sf <- rbind(out_sf, row)
}
}
out_sf
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry))
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
sf::st_as_sf()
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
as.data.frame() %>%
sf::st_as_sf()
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
as.data.frame()
class(out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
as.data.frame())
class(out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
as.data.frame() %>%
sf::st_as_sf())
out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
as.data.frame() %>%
sf::st_as_sf()
out_sf <- out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
as.data.frame() %>%
sf::st_as_sf()
plot(out_sf)
plot(out_sf$geometry[1])
plot(out_sf$geometry[2])
benchmarks_to_networks <- function(benchmarks_sf, network_list){
check_for_network(benchmarks_sf)
check_for_geometry(benchmarks_sf)
counter <- 1
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
dplyr::mutate(network = net)
#sf::st_union()
#row <- sf::st_sf(network = net, geometry = row_sfc)
# append
if(counter == 1){
out_sf <- row
counter <- counter + 1
} else{
out_sf <- rbind(out_sf, row)
}
}
out_sf <- out_sf %>%
dplyr::group_by(network) %>%
dplyr::summarize(geometry = sf::st_union(geometry)) %>%
as.data.frame() %>%
sf::st_as_sf()
return(out_sf)
}
network_list <- rep(network_list, 1000)
length(network_list)
benchmarks_to_networks(benchmarks_sf, network_list)
my_list <- list()
my_list
my_list <- list()
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
dplyr::mutate(network = net)
sf::st_union()
#row <- sf::st_sf(network = net, geometry = row_sfc)
my_list <- append(my_list, list(row))
# # append
# if(counter == 1){
#   out_sf <- row
#   counter <- counter + 1
# } else{
#   out_sf <- rbind(out_sf, row)
# }
}
my_list <- list()
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row_sfc <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
#dplyr::mutate(network = net) %>%
sf::st_union()
row <- sf::st_sf(network = net, geometry = row_sfc)
my_list <- append(my_list, list(row))
# # append
# if(counter == 1){
#   out_sf <- row
#   counter <- counter + 1
# } else{
#   out_sf <- rbind(out_sf, row)
# }
}
out_sf
my_list
length(my_list)
do.call(rbind, my_list)
dplyr::bind_rows(my_list)
benchmarks_to_networks <- function(benchmarks_sf, network_list){
check_for_network(benchmarks_sf)
check_for_geometry(benchmarks_sf)
my_list <- list()
for(net in network_list){
# get benchmark names and check they are in benchmarks_sf$network
nets <- sep_network_name(net)
check_benchmark_sf_names(nets, benchmarks_sf)
# dissolve the network
row_sfc <- benchmarks_sf %>%
dplyr::filter(network %in% nets) %>%
#dplyr::mutate(network = net) %>%
sf::st_union()
row <- sf::st_sf(network = net, geometry = row_sfc)
my_list <- append(my_list, list(row))
}
dplyr::bind_rows(my_list)
return(out_sf)
}
benchmarks_to_networks(benchmarks_sf, network_list)
?requireNamespace
?!!!
d
?"!!!"
requireNamespace("dplyr")
requireNamespace("dplyr", quietly = TRUE)
?requireNamespace
package_version("dplyr")
packageVersion("dplyr")
packageVersion("dplyr")?'1.0.0'
packageVersion("dplyr")>'1.0.0'
packageVersion("dplyr")
packageVersion("dplyr") > "1.0.0"
packageVersion("dplyr") > "2.0.0"
packageVersion("dplyr")
my_list
do.call(rbind, my_list)
